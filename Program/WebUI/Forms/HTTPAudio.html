<!DOCTYPE html>

<!--
# | Pattor Radio
# | Goodies-packed pirate radio station on Linux
# |
# | Copyright (C) 2021, OctoSpacc
# | Licensed under the AGPLv3
-->

<html lang="en">
	<head>
		<meta http-equiv="pragma" content="no-cache" />

		<style>
			.unselectable {
				-webkit-touch-callout: none;
				-webkit-user-select: none;
				-khtml-user-select: none;
				-moz-user-select: none;
				-ms-user-select: none;
				user-select: none;
			}
		</style>
	</head>

	<body class="unselectable" style="text-align: center;">
		<span>Volume: </span><input type="range" min="0" max="1" value="[HTML:WebUIAudioVolume]" step="0.01" id="VolumeBar" onchange="ChangeSoundVolume()" />

		<script>
			const SoundObject = new Audio("/AudioStream/" + Math.random());

			ChangeSoundVolume();
			ServerStatusRefresh();

			SoundObject.addEventListener('ended', ReloadPage);

			function Sleep(Seconds) {
				return new Promise(Resolve => setTimeout(Resolve, Seconds*1000));
			}

			function ChangeSoundVolume() {
				SoundObject.volume = document.getElementById("VolumeBar").value;
			}

			async function ReloadPage() {
				await Sleep(0.5);
				window.location.reload(true);
			}

			async function ServerStatusRefresh() {
				while (true) {
					try {
						var PlayDirectionsResponse = await fetch("/PlayDirections/" + + Math.random());
						var PlayDirections = await PlayDirectionsResponse.text();
					} catch(PlayDirectionsFetchError) {
						console.log("[E] Error fetching PlayDirections.");
					}

					if (PlayDirections == "Pause") {
						if (!SoundObject.paused) {
							SoundObject.pause();
						}

					} else if (PlayDirections == "Skip" || PlayDirections < 0.0) {
						ReloadPage();

					} else {
						if (!isNaN(PlayDirections)) {
							if (SoundObject.paused) {
								SoundObject.currentTime = PlayDirections;
								SoundObject.play();
							}
						}
					}

				await Sleep([JS:RefreshRate]);
				}
			}
		</script>
	</body>
</html>